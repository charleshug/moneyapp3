<% provide(:title, "Spending by Vendor") %>

<div class="bg-gray-100 rounded-lg shadow-md overflow-hidden flex flex-col h-[calc(100vh-180px)] relative">
  <!-- Header -->
  <%= render 'reports/report_header_net_worth'%>

  <!-- Filter sidebar -->
  <div class="bg-white m-4 overflow-hidden">
    <%= render 'reports/vendor_filter_sidebar' %>
  </div>
  
  <!-- Horizontal layout: chart + table -->
  <div class="flex flex-1 overflow-hidden">

  <!-- Chart section -->
  <div class="flex-1 bg-white p-4 mb-4" style="">
    <canvas data-controller="vendor-spending-chart"
            data-chart-data="<%= @output.map { |(_id, name), amount| 
              { 
                label: name || 'N/A', 
                value: amount / 100.0 
              } 
            }.to_json %>">
    </canvas>
  </div>

    <!-- Table section -->
    <div class="w-64 flex flex-col bg-white m-4 rounded-lg shadow-sm overflow-hidden text-xs">
      <!-- Fixed table header -->
      <table class="w-full table-fixed">
        <thead class="bg-gray-50 border-b border-gray-200">
          <tr>
            <th class="px-2 py-1 text-left font-medium text-gray-700 truncate">Vendor</th>
            <th class="px-2 py-1 text-right font-medium text-gray-700 truncate">Amount</th>
          </tr>
        </thead>
      </table>
      
      <!-- Scrollable table body -->
      <div class="overflow-y-auto flex-1">
        <table class="w-full bg-white">
          <tbody>
            <% @output.each do |(vendor_id, vendor_name), amount| %>
              <tr class="hover:bg-gray-50 border-t border-gray-100">
                <td class="px-4 py-2 text-left"><%= vendor_name %></td>
                <td class="px-4 py-2 text-right">
                  <%= link_to number_to_currency((amount / 100.0), precision: 2), 
                      trxes_path(
                        q: {
                          vendor_id_in: [vendor_id],
                          date_gteq: params.dig(:q, :date_gteq),
                          date_lteq: params.dig(:q, :date_lteq),
                          account_id_in: params.dig(:q, :account_id_in)
                        }
                      ) 
                  %>
                </td>
              </tr>
            <% end %>
          </tbody>
          <tfoot class="bg-gray-100 font-bold sticky bottom-0 z-10 border-t border-gray-300">
            <tr>
              <td class="px-4 py-2">Total</td>
              <td class="px-4 py-2 text-right"><%= number_to_currency((@output.values.sum / 100.0), precision: 2) %></td>
            </tr>
          </tfoot>
        </table>
      </div>
</div>