<% provide(:title, "Transactions") %>

<div class="bg-gray-100 shadow-md overflow-hidden flex flex-col ">

  <!-- filter -->
  <%= render 'trxes/filter_sidebar' %>

  <!-- Transactions list -->
<div class="flex flex-col flex-grow max-h-screen">
  <% if @trxes.any? %>
    <!-- Header row -->
    <div class="bg-white shadow-sm p-1 border-b border-gray-200 sticky top-0 z-10">
      <div class="grid grid-cols-9 items-center text-center font-medium text-blue-600">
        <div>ID</div>
        <div>Account</div>
        <div>Date</div>
        <div>Vendor</div>
        <div>Amount</div>
        <div>Category</div>
        <div>Subcategory</div>
        <div>Memo</div>
        <div>Cleared</div>
      </div>
    </div>

    <!-- Scrollable data rows -->
    <div class="overflow-y-auto flex-grow" style="max-height: calc(100vh - 200px);">
      <% @trxes.each do |trx| %>
        <% if trx.lines.size == 1 %>
          <div class="odd:bg-white even:bg-blue-50 bg-white shadow-sm p-1 hover:bg-gray-50 border-b border-gray-200">
            <div class="grid grid-cols-9 items-center text-center text-gray-800">
              <div><%= trx.id %></div>
              <div><%= trx.account.name %></div>
              <div><%= trx.date %></div>
              <div><%= trx.vendor.name %></div>
              <div><%= number_to_currency(trx.amount / 100.0) %></div>
              <div><%= trx.lines.first&.ledger&.subcategory&.category&.name %></div>
              <div><%= trx.lines.first&.ledger&.subcategory&.name %></div>
              <div class="truncate" title="<%= trx.memo %>"><%= trx.memo %></div>
              <div data-controller="cleared-toggle"
                  data-cleared-toggle-trx-id-value="<%= trx.id %>"
                  data-cleared-toggle-cleared-value="<%= trx.cleared %>">
                <button data-action="click->cleared-toggle#toggle" class="focus:outline-none">
                  <div data-cleared-toggle-target="circle"
                      class="w-4 h-4 rounded-full <%= trx.cleared ? 'bg-green-500' : 'bg-gray-300' %> mx-auto">
                  </div>
                </button>
              </div>
            </div>
          </div>
        <% else %>
          <div class="odd:bg-white even:bg-blue-50 bg-white shadow-sm p-1 hover:bg-gray-50 border-b border-gray-200">
            <div class="grid grid-cols-9 items-center text-center text-gray-800 truncate whitespace-nowrap overflow-hidden">
              <div><%= trx.id %></div>
              <div><%= trx.account.name %></div>
              <div><%= trx.date %></div>
              <div><%= trx.vendor.name %></div>
              <div><%= number_to_currency(trx.amount / 100.0) %></div>
              <div></div>
              <div>Split (Multiple Categories)...</div>
              <div class="truncate" title="<%= trx.memo %>"><%= trx.memo %></div>
              <div data-controller="cleared-toggle"
                  data-cleared-toggle-trx-id-value="<%= trx.id %>"
                  data-cleared-toggle-cleared-value="<%= trx.cleared %>">
                <button data-action="click->cleared-toggle#toggle" class="focus:outline-none">
                  <div data-cleared-toggle-target="circle"
                      class="w-4 h-4 rounded-full <%= trx.cleared ? 'bg-green-500' : 'bg-gray-300' %> mx-auto">
                  </div>
                </button>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

    <!-- Footer -->
    <div class="mt-4 flex justify-between items-center sticky bottom-0 bg-gray-100 p-2 border-t border-gray-200">
      <div class="text-sm text-gray-600">
        <strong>Page:</strong> <%= pluralize(@trxes.size, 'transaction') %>
        <span class="mx-2">|</span>
        <strong>Total:</strong> <%= pluralize(@filtered_count, 'transaction') %>
      </div>
      <div>
        <%= custom_pagy_nav(@pagy) %>
      </div>
    </div>
  <% else %>
    <div class="flex-grow flex items-center justify-center">
      <div class="text-center p-8 bg-white rounded-lg shadow-sm max-w-md">
        <p class="text-gray-600 mb-4">No transactions found.</p>
        <%= link_to new_trx_path, class: "px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md inline-block" do %>
          <i class="fas fa-plus mr-2"></i> Create Your First Transaction
        <% end %>
      </div>
    </div>
  <% end %>
</div>
