<% provide(:title, "Transactions") %>

<style>
  .selected-row {
    background-color: #fef3c7 !important; /* bg-yellow-200 */
  }
  .selected-row:hover {
    background-color: #fef3c7 !important; /* Keep yellow on hover */
  }
  .editing-row {
    background-color: #dbeafe !important; /* bg-blue-100 */
    border: 2px solid #3b82f6 !important; /* border-blue-500 */
  }
  .editing-row:hover {
    background-color: #dbeafe !important; /* Keep blue on hover */
  }
</style>

<div class="bg-gray-100 shadow-md overflow-hidden flex flex-col" style="height: 100vh;" data-controller="trx-selection">


  <!-- Filter Bar -->
  <%= render 'trxes/filter_bar' %>

  <!-- Transactions list -->
  <%= render 'trxes/trx_list', trxes: @trxes, filtered_count: @filtered_count, pagy: @pagy %>

<!-- Bottom Section: New Transaction Form (hidden by default) -->
<%= render 'trxes/new_trx_hidden_form' %>

  <!-- Bottom Section: Scheduled Transactions and Balance Information -->
  <div class="bg-white border-t border-gray-200 p-4 z-20" style="height: 120px; flex-shrink: 0;" data-budget-id="<%= @current_budget.id %>" data-trx-selection-target="balanceDisplay">
    <div class="flex justify-between items-center">
      <!-- Left: New Transaction and Scheduled Transactions Buttons -->
      <div class="flex gap-3">
        <!-- New Transaction Button -->
        <button data-trx-form-toggle-target="button" 
                data-action="click->trx-form-toggle#showForm" 
                class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md inline-flex items-center">
          <i class="fas fa-plus mr-2"></i> 
          <span class="text-center">
            <div>New</div>
            <div>Transaction</div>
          </span>
        </button>
      
        <!-- Scheduled Transactions Button -->
        <div>
          <%= link_to scheduled_trxes_path, class: "px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-md inline-flex items-center relative" do %>
            <i class="fas fa-calendar-alt mr-2"></i> 
            <span class="text-center">
              <div>Scheduled</div>
              <div>Transactions</div>
            </span>
            <% scheduled_count = @current_budget.scheduled_trxes.where(active: true).count %>
            <% if scheduled_count > 0 %>
              <div class="absolute -top-2 -right-2 bg-gray-800 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold">
                <%= scheduled_count %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
      
      <!-- Right: Balance Information and Reconcile Button -->
      <div class="flex items-center gap-6">
        <!-- Balance Display Box -->
        <div data-trx-selection-target="balanceContainer">
          <%= render 'balance_display' %>
        </div>
        
        <!-- Reconcile Account Button -->
        <div>
          <button class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-md inline-flex items-center">
            <i class="fas fa-balance-scale mr-2"></i> 
            <span class="text-center">
              <div>Reconcile</div>
              <div>Account</div>
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

