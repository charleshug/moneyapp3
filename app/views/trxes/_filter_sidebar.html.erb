<!-- Filter Sidebar for Transactions -->
<div id="filter-sidebar" class="bg-white w-full">
  <div class="flex flex-col w-full">

    <!-- Filter Row -->
    <div class="w-full overflow-x-auto border-b border-gray-200 p-4">
      <%= search_form_for @q, class: 'flex flex-wrap items-end gap-4 w-full', data: { filter_sidebar_target: "form" } do |f| %>

        <!-- Date From -->
        <div class="flex flex-col">
          <%= f.label :date_gteq, "Date From", class: "text-sm font-medium text-gray-700" %>
          <%= f.date_field :date_gteq, class: "w-40 rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50", data: { action: "change->filter-sidebar#checkFilters" } %>
        </div>

        <!-- Date To -->
        <div class="flex flex-col">
          <%= f.label :date_lteq, "Date To", class: "text-sm font-medium text-gray-700" %>
          <%= f.date_field :date_lteq, class: "w-40 rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50", data: { action: "change->filter-sidebar#checkFilters" } %>
        </div>

        <!-- Accounts -->
        <div class="flex flex-col flex-1 min-w-[200px]" 
             data-controller="dropdown-filter"
             data-dropdown-filter-field-name-value="account_id_in"
             data-dropdown-filter-placeholder-value="Filter Accounts..."
             data-dropdown-filter-selected-ids-value="<%= params.dig(:q, :account_id_in) || [] %>">
          <%= f.label :account_id_in, "Accounts", class: "text-sm font-medium text-gray-700" %>
          <div class="relative">
            <button type="button" 
                    data-dropdown-filter-target="button"
                    data-action="click->dropdown-filter#toggle"
                    class="dropdown-filter-button w-full text-left px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              Filter Accounts...
            </button>
            <div data-dropdown-filter-target="dropdown" class="dropdown-filter-dropdown hidden absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto">
              <div data-dropdown-filter-target="options" class="py-1">
                <% @accounts.each do |account| %>
                  <div class="dropdown-filter-option px-3 py-2 cursor-pointer flex items-center"
                       data-action="click->dropdown-filter#selectOption">
                    <input type="checkbox" 
                           value="<%= account.id %>" 
                           class="mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                           <%= 'checked' if params.dig(:q, :account_id_in)&.include?(account.id.to_s) %>>
                    <label class="flex-1 cursor-pointer"><%= account.name %></label>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
          <div class="hidden-form-fields"></div>
        </div>

        <!-- Vendors -->
        <div class="flex flex-col flex-1 min-w-[200px]" 
             data-controller="dropdown-filter"
             data-dropdown-filter-field-name-value="vendor_id_in"
             data-dropdown-filter-placeholder-value="Filter Vendors..."
             data-dropdown-filter-selected-ids-value="<%= params.dig(:q, :vendor_id_in) || [] %>">
          <%= f.label :vendor_id_in, "Vendors", class: "text-sm font-medium text-gray-700" %>
          <div class="relative">
            <button type="button" 
                    data-dropdown-filter-target="button"
                    data-action="click->dropdown-filter#toggle"
                    class="dropdown-filter-button w-full text-left px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              Filter Vendors...
            </button>
            <div data-dropdown-filter-target="dropdown" class="dropdown-filter-dropdown hidden absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto">
              <div data-dropdown-filter-target="options" class="py-1">
                <% @vendors.order('LOWER(name)').each do |vendor| %>
                  <div class="dropdown-filter-option px-3 py-2 cursor-pointer flex items-center"
                       data-action="click->dropdown-filter#selectOption">
                    <input type="checkbox" 
                           value="<%= vendor.id %>" 
                           class="mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                           <%= 'checked' if params.dig(:q, :vendor_id_in)&.include?(vendor.id.to_s) %>>
                    <label class="flex-1 cursor-pointer"><%= vendor.name %></label>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
          <div class="hidden-form-fields"></div>
        </div>

        <!-- Categories -->
        <div class="flex flex-col flex-1 min-w-[200px]" 
             data-controller="dropdown-filter"
             data-dropdown-filter-field-name-value="lines_ledger_subcategory_category_id_in"
             data-dropdown-filter-placeholder-value="Filter Categories..."
             data-dropdown-filter-selected-ids-value="<%= params.dig(:q, :lines_ledger_subcategory_category_id_in) || [] %>">
          <%= f.label :lines_ledger_subcategory_category_id_in, "Categories", class: "text-sm font-medium text-gray-700" %>
          <div class="relative">
            <button type="button" 
                    data-dropdown-filter-target="button"
                    data-action="click->dropdown-filter#toggle"
                    class="dropdown-filter-button w-full text-left px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              Filter Categories...
            </button>
            <div data-dropdown-filter-target="dropdown" class="dropdown-filter-dropdown hidden absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto">
              <div data-dropdown-filter-target="options" class="py-1">
                <% @categories.each do |category| %>
                  <div class="dropdown-filter-option px-3 py-2 cursor-pointer flex items-center"
                       data-action="click->dropdown-filter#selectOption">
                    <input type="checkbox" 
                           value="<%= category.id %>" 
                           class="mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                           <%= 'checked' if params.dig(:q, :lines_ledger_subcategory_category_id_in)&.include?(category.id.to_s) %>>
                    <label class="flex-1 cursor-pointer"><%= category.name %></label>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
          <div class="hidden-form-fields"></div>
        </div>

        <!-- Subcategories -->
        <div class="flex flex-col flex-1 min-w-[200px]" 
             data-controller="dropdown-filter"
             data-dropdown-filter-field-name-value="lines_ledger_subcategory_id_in"
             data-dropdown-filter-placeholder-value="Filter Subcategories..."
             data-dropdown-filter-selected-ids-value="<%= params.dig(:q, :lines_ledger_subcategory_id_in) || [] %>">
          <%= f.label :lines_ledger_subcategory_id_in, "Subcategories", class: "text-sm font-medium text-gray-700" %>
          <div class="relative">
            <button type="button" 
                    data-dropdown-filter-target="button"
                    data-action="click->dropdown-filter#toggle"
                    class="dropdown-filter-button w-full text-left px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              Filter Subcategories...
            </button>
            <div data-dropdown-filter-target="dropdown" class="dropdown-filter-dropdown hidden absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto">
              <div data-dropdown-filter-target="options" class="py-1">
                <% @categories.each do |category| %>
                  <% if category.subcategories.any? %>
                    <div class="px-3 py-1 text-sm font-medium text-gray-500 bg-gray-50 border-b">
                      <%= category.name %>
                    </div>
                    <% category.subcategories.each do |subcategory| %>
                      <div class="dropdown-filter-option px-6 py-2 cursor-pointer flex items-center"
                           data-action="click->dropdown-filter#selectOption">
                        <input type="checkbox" 
                               value="<%= subcategory.id %>" 
                               class="mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                               <%= 'checked' if params.dig(:q, :lines_ledger_subcategory_id_in)&.include?(subcategory.id.to_s) %>>
                        <label class="flex-1 cursor-pointer"><%= subcategory.name %></label>
                      </div>
                    <% end %>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
          <div class="hidden-form-fields"></div>
        </div>

        <!-- Cleared -->
        <div class="flex flex-col w-40" 
             data-controller="dropdown-filter"
             data-dropdown-filter-field-name-value="cleared_eq"
             data-dropdown-filter-placeholder-value="Filter Cleared..."
             data-dropdown-filter-selected-ids-value="<%= [params.dig(:q, :cleared_eq)].compact %>">
          <%= f.label :cleared_eq, "Cleared", class: "text-sm font-medium text-gray-700" %>
          <div class="relative">
            <button type="button" 
                    data-dropdown-filter-target="button"
                    data-action="click->dropdown-filter#toggle"
                    class="dropdown-filter-button w-full text-left px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              Filter Cleared...
            </button>
            <div data-dropdown-filter-target="dropdown" class="dropdown-filter-dropdown hidden absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto">
              <div data-dropdown-filter-target="options" class="py-1">
                <div class="dropdown-filter-option px-3 py-2 cursor-pointer flex items-center"
                     data-action="click->dropdown-filter#selectOption">
                  <input type="checkbox" 
                         value="" 
                         class="mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                         <%= 'checked' if params.dig(:q, :cleared_eq).blank? %>>
                  <label class="flex-1 cursor-pointer">All</label>
                </div>
                <div class="dropdown-filter-option px-3 py-2 cursor-pointer flex items-center"
                     data-action="click->dropdown-filter#selectOption">
                  <input type="checkbox" 
                         value="true" 
                         class="mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                         <%= 'checked' if params.dig(:q, :cleared_eq) == 'true' %>>
                  <label class="flex-1 cursor-pointer">Cleared</label>
                </div>
                <div class="dropdown-filter-option px-3 py-2 cursor-pointer flex items-center"
                     data-action="click->dropdown-filter#selectOption">
                  <input type="checkbox" 
                         value="false" 
                         class="mr-2 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                         <%= 'checked' if params.dig(:q, :cleared_eq) == 'false' %>>
                  <label class="flex-1 cursor-pointer">Uncleared</label>
                </div>
              </div>
            </div>
          </div>
          <div class="hidden-form-fields"></div>
        </div>

        <!-- Apply / Clear -->
        <div class="flex items-end space-x-2">
          <%= f.submit "Apply", class: "px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md" %>
          <%= link_to "Clear", trxes_path, class: "px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md" %>
        </div>

      <% end %>
    </div>

  </div>
</div>